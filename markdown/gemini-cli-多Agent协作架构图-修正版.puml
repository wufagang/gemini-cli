@startuml Gemini CLI å¤šAgentåä½œç³»ç»Ÿæ¶æ„å›¾
!theme aws-orange

title **Gemini CLI å¤šAgentåä½œç³»ç»Ÿæ¶æ„å›¾**\nåŸºäºAgenté©±åŠ¨çš„AIå·¥å…·å¹³å°

' å®šä¹‰é¢œè‰²
!define MAIN_AGENT #1E40AF
!define SUBAGENT #7C3AED
!define A2A_SERVER #059669
!define MCP_AGENT #DC2626
!define TOOL_AGENT #EA580C
!define EXTERNAL #6B7280
!define DATA_LAYER #10B981

' ========================================
' ä¸»Agentå±‚ (Main Agent Layer)
' ========================================
rectangle "ğŸ¤– **ä¸»Agentå±‚ (Primary Agent)**" as main_agent_layer MAIN_AGENT {

  component [**GeminiCLIä¸»Agent**\n(packages/cli)\n- ç”¨æˆ·äº¤äº’ç®¡ç†\n- AIå¯¹è¯æ§åˆ¶\n- ä»»åŠ¡è°ƒåº¦åè°ƒ] as main_agent

  rectangle "Agentæ ¸å¿ƒç»„ä»¶" as agent_core {
    component [GeminiClient\nAIå¯¹è¯å¼•æ“] as gemini_client
    component [AgentExecutor\nAgentæ‰§è¡Œå™¨] as agent_executor
    component [TaskManager\nä»»åŠ¡ç®¡ç†å™¨] as task_manager
    component [ToolOrchestrator\nå·¥å…·ç¼–æ’å™¨] as tool_orchestrator
  }

  note top of main_agent
    **ä¸»AgentèŒè´£ï¼š**
    â€¢ ç”¨æˆ·äº¤äº’å’Œä¼šè¯ç®¡ç†
    â€¢ AIå¯¹è¯æµç¨‹æ§åˆ¶
    â€¢ Subagentä»»åŠ¡è°ƒåº¦
    â€¢ å·¥å…·è°ƒç”¨åè°ƒ
    â€¢ ç»ˆç«¯UIæ¸²æŸ“ (React+Ink)
  end note
}

' ========================================
' A2A Server (Agent-to-Agenté€šä¿¡ä¸­å¿ƒ)
' ========================================
rectangle "ğŸ”— **A2A Server (Agenté—´é€šä¿¡ä¸­å¿ƒ)**" as a2a_server_layer A2A_SERVER {

  component [**A2A Server**\n(packages/a2a-server)\n- Agenté—´é€šä¿¡åè°ƒ\n- ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†\n- çŠ¶æ€åŒæ­¥åˆ†å‘] as a2a_server

  rectangle "A2Aæ ¸å¿ƒæœåŠ¡" as a2a_core {
    component [CoderAgentExecutor\nAgentæ‰§è¡Œå™¨] as coder_executor
    component [TaskWrapper\nä»»åŠ¡åŒ…è£…å™¨] as task_wrapper
    component [ExecutionEventBus\näº‹ä»¶æ€»çº¿] as event_bus
    component [HTTP API Server\nRESTæ¥å£] as http_api
  }

  note top of a2a_server
    **A2A ServerèŒè´£ï¼š**
    â€¢ Agenté—´é€šä¿¡åè°ƒ
    â€¢ ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
    â€¢ çŠ¶æ€åŒæ­¥å’Œäº‹ä»¶åˆ†å‘
    â€¢ å¤šAgentä¼šè¯ç®¡ç†
  end note
}

' ========================================
' Subagentå±‚ (ä¸“ç”¨Agentç³»ç»Ÿ)
' ========================================
rectangle "ğŸ¯ **Subagentå±‚ (ä¸“ç”¨Agentç³»ç»Ÿ)**" as subagent_layer SUBAGENT {

  component [**CodeAnalyzer Agent**\nä»£ç åˆ†æä¸“å®¶\n- ä»£ç å®¡æŸ¥\n- é‡æ„å»ºè®®\n- æ¶æ„åˆ†æ] as code_analyzer_agent

  component [**FileManager Agent**\næ–‡ä»¶ç®¡ç†ä¸“å®¶\n- æ–‡ä»¶æ“ä½œ\n- ç›®å½•ç®¡ç†\n- æ‰¹é‡å¤„ç†] as file_manager_agent

  component [**DevOps Agent**\nè¿ç»´ä¸“å®¶\n- éƒ¨ç½²ç®¡ç†\n- ç›‘æ§å‘Šè­¦\n- CI/CDæµç¨‹] as devops_agent

  component [**Research Agent**\nç ”ç©¶åŠ©æ‰‹\n- ä¿¡æ¯æœç´¢\n- æ–‡æ¡£ç”Ÿæˆ\n- çŸ¥è¯†æ•´ç†] as research_agent

  rectangle "SubagentåŸºç¡€è®¾æ–½" as subagent_infra {
    component [SubagentToolWrapper\nå·¥å…·åŒ…è£…å™¨] as subagent_wrapper
    component [AgentDefinition\nAgentå®šä¹‰ç³»ç»Ÿ] as agent_definition
    component [AgentRegistry\nAgentæ³¨å†Œè¡¨] as agent_registry
  }

  note top of subagent_layer
    **Subagentç³»ç»Ÿç‰¹ç‚¹ï¼š**
    â€¢ ä¸“é—¨åŒ–ä»»åŠ¡å¤„ç†
    â€¢ å¯ä½œä¸ºå·¥å…·è¢«è°ƒç”¨
    â€¢ ç‹¬ç«‹çš„AIæ¨¡å‹é…ç½®
    â€¢ æ ‡å‡†åŒ–è¾“å…¥è¾“å‡ºæ¥å£
  end note
}

' ========================================
' MCP Agentç”Ÿæ€ (ç¬¬ä¸‰æ–¹Agent)
' ========================================
rectangle "ğŸŒ **MCP Agentç”Ÿæ€ (ç¬¬ä¸‰æ–¹Agent)**" as mcp_agent_layer MCP_AGENT {

  component [**Database Agent**\næ•°æ®åº“æ“ä½œ\n- SQLæŸ¥è¯¢\n- æ•°æ®åˆ†æ\n- æŠ¥è¡¨ç”Ÿæˆ] as db_agent

  component [**API Testing Agent**\nAPIæµ‹è¯•\n- æ¥å£æµ‹è¯•\n- æ€§èƒ½ç›‘æ§\n- è‡ªåŠ¨åŒ–éªŒè¯] as api_test_agent

  component [**Cloud Services Agent**\näº‘æœåŠ¡ç®¡ç†\n- AWS/GCP/Azure\n- èµ„æºç®¡ç†\n- æˆæœ¬ä¼˜åŒ–] as cloud_agent

  component [**Slack Agent**\nå›¢é˜Ÿåä½œ\n- æ¶ˆæ¯å‘é€\n- å·¥ä½œæµé›†æˆ\n- é€šçŸ¥ç®¡ç†] as slack_agent

  rectangle "MCPåŸºç¡€è®¾æ–½" as mcp_infra {
    component [McpClientManager\nMCPå®¢æˆ·ç«¯ç®¡ç†] as mcp_client_manager
    component [MCPProxyTool\nMCPä»£ç†å·¥å…·] as mcp_proxy
    component [ToolDiscovery\nå·¥å…·å‘ç°å¼•æ“] as tool_discovery
  }

  note top of mcp_agent_layer
    **MCP Agentç”Ÿæ€ï¼š**
    â€¢ åŸºäºMCPåè®®æ ‡å‡†åŒ–
    â€¢ ç¤¾åŒºé©±åŠ¨å·¥å…·æä¾›è€…
    â€¢ å¯æ’æ‹”èƒ½åŠ›æ‰©å±•
    â€¢ è·¨è¯­è¨€è·¨å¹³å°æ”¯æŒ
  end note
}

' ========================================
' å·¥å…·Agentå±‚ (å†…ç½®å·¥å…·Agent)
' ========================================
rectangle "ğŸ”§ **å·¥å…·Agentå±‚ (å†…ç½®å·¥å…·)**" as tool_agent_layer TOOL_AGENT {

  rectangle "ç³»ç»Ÿå·¥å…·Agent" as system_tools {
    component [ShellAgent\nShellæ‰§è¡Œä¸“å®¶] as shell_agent
    component [FileAgent\næ–‡ä»¶æ“ä½œä¸“å®¶] as file_agent
    component [GitAgent\nGitæ“ä½œä¸“å®¶] as git_agent
    component [SearchAgent\næœç´¢ä¸“å®¶] as search_agent
  }

  rectangle "ç½‘ç»œå·¥å…·Agent" as network_tools {
    component [WebAgent\nç½‘ç»œè¯·æ±‚ä¸“å®¶] as web_agent
    component [APIAgent\nAPIè°ƒç”¨ä¸“å®¶] as api_agent
  }

  rectangle "å¼€å‘å·¥å…·Agent" as dev_tools {
    component [CodeAgent\nä»£ç æ“ä½œä¸“å®¶] as code_agent
    component [TestAgent\næµ‹è¯•æ‰§è¡Œä¸“å®¶] as test_agent
    component [BuildAgent\næ„å»ºä¸“å®¶] as build_agent
  }

  note top of tool_agent_layer
    **å†…ç½®å·¥å…·Agentï¼š**
    â€¢ é«˜åº¦ä¼˜åŒ–çš„æ ¸å¿ƒå·¥å…·
    â€¢ ç›´æ¥é›†æˆæ— åè®®å¼€é”€
    â€¢ å®‰å…¨æ²™ç®±æ‰§è¡Œç¯å¢ƒ
    â€¢ ä¸°å¯Œçš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
  end note
}

' ========================================
' å¤–éƒ¨æœåŠ¡å±‚
' ========================================
cloud "ğŸŒ **å¤–éƒ¨æœåŠ¡å±‚**" as external_services EXTERNAL {

  rectangle "Google AIç”Ÿæ€" as google_ai {
    component [Gemini API\nAIæ¨¡å‹æœåŠ¡] as gemini_api
    component [Vertex AI\nä¼ä¸šAIå¹³å°] as vertex_ai
    component [Google Search\næœç´¢grounding] as google_search
  }

  rectangle "å¼€å‘ç”Ÿæ€" as dev_ecosystem {
    component [GitHub\nä»£ç ä»“åº“] as github
    component [VS Code\né›†æˆå¼€å‘ç¯å¢ƒ] as vscode
    component [Docker\nå®¹å™¨è¿è¡Œæ—¶] as docker
  }

  rectangle "ä¼ä¸šæœåŠ¡" as enterprise_services {
    component [Slack\nå›¢é˜Ÿåä½œ] as slack
    component [Jira\né¡¹ç›®ç®¡ç†] as jira
    component [Cloud Services\näº‘æœåŠ¡å¹³å°] as cloud_services
  }
}

' ========================================
' æ•°æ®å’ŒçŠ¶æ€å±‚
' ========================================
database "ğŸ’¾ **AgentçŠ¶æ€å’Œæ•°æ®å±‚**" as data_layer DATA_LAYER {
  component [Agenté…ç½®å­˜å‚¨] as agent_configs
  component [ä»»åŠ¡çŠ¶æ€å­˜å‚¨] as task_states
  component [ä¼šè¯å†å²å­˜å‚¨] as conversation_history
  component [å·¥å…·ç¼“å­˜å­˜å‚¨] as tool_cache
  component [æƒé™é…ç½®å­˜å‚¨] as permission_configs
}

' ========================================
' Agenté—´é€šä¿¡æµ (æ ¸å¿ƒæ•°æ®æµ)
' ========================================

' ä¸»Agentåˆ°A2A Server
main_agent -down-> a2a_server : "Agentä»»åŠ¡å§”æ´¾"
tool_orchestrator -down-> coder_executor : "ä»»åŠ¡æäº¤"
task_manager -down-> task_wrapper : "ä»»åŠ¡ç®¡ç†"

' A2A Serveråˆ°Subagent
a2a_server -down-> subagent_layer : "Subagentè°ƒç”¨"
coder_executor -down-> code_analyzer_agent : "ä»£ç åˆ†æä»»åŠ¡"
coder_executor -down-> file_manager_agent : "æ–‡ä»¶ç®¡ç†ä»»åŠ¡"
event_bus -down-> subagent_infra : "çŠ¶æ€åŒæ­¥"

' ä¸»Agentåˆ°MCP Agent
main_agent -right-> mcp_agent_layer : "MCPå·¥å…·è°ƒç”¨"
tool_orchestrator -right-> mcp_client_manager : "MCPå·¥å…·å‘ç°"
mcp_proxy -right-> db_agent : "æ•°æ®åº“æ“ä½œ"
mcp_proxy -right-> api_test_agent : "APIæµ‹è¯•"

' ä¸»Agentåˆ°å·¥å…·Agent
main_agent -down-> tool_agent_layer : "å†…ç½®å·¥å…·è°ƒç”¨"
tool_orchestrator -down-> shell_agent : "Shellæ‰§è¡Œ"
tool_orchestrator -down-> file_agent : "æ–‡ä»¶æ“ä½œ"
tool_orchestrator -down-> web_agent : "ç½‘ç»œè¯·æ±‚"

' æ‰€æœ‰Agentåˆ°å¤–éƒ¨æœåŠ¡
main_agent -right-> gemini_api : "AI APIè°ƒç”¨"
subagent_layer -right-> external_services : "å¤–éƒ¨æœåŠ¡é›†æˆ"
mcp_agent_layer -right-> external_services : "ç¬¬ä¸‰æ–¹æœåŠ¡"
tool_agent_layer -right-> external_services : "ç³»ç»Ÿèµ„æºè®¿é—®"

' æ•°æ®å±‚è¿æ¥
main_agent -down-> data_layer : "çŠ¶æ€æŒä¹…åŒ–"
a2a_server -down-> data_layer : "ä»»åŠ¡çŠ¶æ€ç®¡ç†"
subagent_layer -down-> data_layer : "Agenté…ç½®"
mcp_agent_layer -down-> data_layer : "å·¥å…·ç¼“å­˜"

' ========================================
' å…³é”®ç‰¹æ€§æ ‡æ³¨
' ========================================

note left of main_agent_layer
  **ğŸš€ Agentåä½œä¼˜åŠ¿**
  â€¢ ä»»åŠ¡ä¸“ä¸šåŒ–åˆ†å·¥
  â€¢ å¹¶è¡Œå¤„ç†èƒ½åŠ›
  â€¢ æ¨¡å—åŒ–å¯æ‰©å±•
  â€¢ æ•…éšœéš”ç¦»æœºåˆ¶
  â€¢ è´Ÿè½½å‡è¡¡åˆ†å‘
end note

note right of a2a_server_layer
  **âš¡ é€šä¿¡ä¸­å¿ƒç‰¹æ€§**
  â€¢ æ ‡å‡†åŒ–Agentåè®®
  â€¢ ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
  â€¢ å®æ—¶çŠ¶æ€åŒæ­¥
  â€¢ æ¶ˆæ¯é˜Ÿåˆ—æœºåˆ¶
  â€¢ é”™è¯¯æ¢å¤æœºåˆ¶
end note

note bottom of mcp_agent_layer
  **ğŸ”Œ MCPç”Ÿæ€ä»·å€¼**
  â€¢ ç¤¾åŒºé©±åŠ¨æ‰©å±•
  â€¢ è·¨è¯­è¨€å…¼å®¹
  â€¢ æ ‡å‡†åŒ–æ¥å£
  â€¢ çƒ­æ’æ‹”èƒ½åŠ›
  â€¢ ä¸°å¯Œå·¥å…·åº“
end note

' ========================================
' Agentæ‰§è¡Œæµç¨‹æ ‡æ³¨
' ========================================

note top of main_agent_layer
  **ğŸ¯ å¤šAgentæ‰§è¡Œæµç¨‹**
  1. ç”¨æˆ·è¾“å…¥ â†’ ä¸»Agentåˆ†æ
  2. ä»»åŠ¡åˆ†è§£ â†’ é€‰æ‹©åˆé€‚Agent
  3. é€šè¿‡A2A Serverå§”æ´¾ä»»åŠ¡
  4. Subagent/MCP Agentæ‰§è¡Œ
  5. ç»“æœèšåˆ â†’ ç”¨æˆ·å±•ç¤º
end note

@enduml